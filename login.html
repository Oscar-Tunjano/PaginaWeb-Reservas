<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Iniciar Sesión</title>
</head>
<body>

<h2>Iniciar sesión</h2>

<form id="loginForm">
    <input id="email" type="email" placeholder="Correo electrónico" required><br>
    <input id="password" type="password" placeholder="Contraseña" required><br>
    <button type="submit">Ingresar</button>
</form>

<p>¿No tienes cuenta? <a href="registro.html">Regístrate aquí</a></p>

<script>
// =======================================
//   API REAL DEL BACKEND (Render)
// =======================================
const API_URL = "https://reservas-backend-sm.onrender.com";

// =======================================
//   LOGIN
// =======================================
document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const correo = document.getElementById("email").value.trim().toLowerCase();
    const contrasena = document.getElementById("password").value;  // <-- CORREGIDO

    if (!correo || !contrasena) {
        alert("Por favor ingresa tu correo y contraseña.");
        return;
    }

    try {
        const response = await fetch(API_URL + "/api/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",   // NECESARIO PARA SESIONES
            body: JSON.stringify({ correo, contrasena })   // <-- CORREGIDO
        });

        const data = await response.json();

        if (!response.ok) {
            alert(data.error || "Credenciales incorrectas");
            return;
        }

        // Guardar datos para el dashboard
        localStorage.setItem("userEmail", data.user.correo);
        localStorage.setItem("userRole", data.user.role);

        // Redirección según rol
        if (data.user.role === "admin") {
            window.location.href = "dashboard-admin.html";
        } else {
            window.location.href = "dashboard-cliente.html";
        }

    } catch (error) {
        console.error("Error en login:", error);
        alert("Error al conectar con el servidor");
    }
});
</script>

</body>
</html>



